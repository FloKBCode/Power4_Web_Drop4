<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Puissance 4 - Scores Néon</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <!-- BOUTON RETOUR MENU -->
  <a href="/" class="menu-btn">⬅️ Menu</a>

  <h1>🎮 Puissance 4 🎮</h1>
  
  <!-- TABLEAU DE SCORES NÉON avec pseudos du backend -->
  <div class="scoreboard neon">
    <div class="player-label red">{{.Player1Name}}</div>
    <div class="score-value">{{.ScoreP1}}</div>
    <div class="score-separator">-</div>
    <div class="score-value">{{.ScoreP2}}</div>
    <div class="player-label yellow">{{.Player2Name}}</div>
  </div>

  <!-- INFO JOUEUR avec pseudo dynamique -->
  {{if .GameOver}}
    {{if eq .Winner 0}}
      <div class="player-info">⚖️ Match nul !</div>
    {{else}}
      <div class="player-info winner">🏆 {{.GetWinnerName}} a gagné ! 🏆</div>
    {{end}}
  {{else}}
    <div class="player-info">Au tour de {{.GetCurrentPlayerName}}</div>
  {{end}}
  
  {{if .Error}}
    <div class="error-message">{{.Error}}</div>
  {{end}}
  
  <!-- GRILLE DE JEU -->
  <div class="game-container">
    <div class="grid">
      {{range $i := Seq 6}}
        {{range $j := Seq 7}}
          <form method="POST" action="/play" style="margin: 0; padding: 0;">
            <input type="hidden" name="column" value="{{$j}}">
            <button type="submit" class="cell" {{if $.GameOver}}disabled{{end}} {{if IsColumnFull $j}}disabled{{end}}>
              {{$cellValue := $.GetCell $i $j}}
              {{if eq $cellValue 1}}
                {{$isLastMove := false}}
                {{if $.History}}
                  {{$lastMove := index $.History (sub (len $.History) 1)}}
                  {{if and (eq $lastMove.Row $i) (eq $lastMove.Column $j)}}
                    {{$isLastMove = true}}
                  {{end}}
                {{end}}
                <div class="token red {{if $isLastMove}}last-move{{end}} {{if $.IsWinningCell $i $j}}active{{end}}"></div>
              {{else if eq $cellValue 2}}
                {{$isLastMove := false}}
                {{if $.History}}
                  {{$lastMove := index $.History (sub (len $.History) 1)}}
                  {{if and (eq $lastMove.Row $i) (eq $lastMove.Column $j)}}
                    {{$isLastMove = true}}
                  {{end}}
                {{end}}
                <div class="token yellow {{if $isLastMove}}last-move{{end}} {{if $.IsWinningCell $i $j}}active{{end}}"></div>
              {{end}}
            </button>
          </form>
        {{end}}
      {{end}}
    </div>
  </div>
  <!-- Historique des coups -->
   {{if .History}}
   <div class="history-panel">
    <h3>📜 Historique</h3>
    <div class="history-list">
      {{range $index, $move := .History}}
        <div class="history-item">
          #{{add $index 1}} - 
          {{if eq $move.Player 1}}🔴{{else}}🟡{{end}}
          Col {{add $move.Column 1}}
        </div>
      {{end}}
    </div>
  </div>
  {{end}}
  
  <!-- Masqué car on clique directement sur les cases -->
  <div class="controls" style="display: none;"></div>
  
  <!-- BOUTONS DE CONTRÔLE -->
  <div class="button-container">
    <form method="POST" action="/reset" style="margin: 0;">
      <button type="submit" class="reset-btn">🔄 Nouvelle Partie</button>
    </form>
    <form method="POST" action="/reset-scores" style="margin: 0;">
      <button type="submit" class="score-reset-btn">📊 Reset Scores</button>
    </form>
  </div>
</body>
</html>