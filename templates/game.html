<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Power 4 - {{.Player1Name}} vs {{.Player2Name}}</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <h1>ğŸ® Puissance 4 ğŸ®</h1>
    
    <!-- SCOREBOARD AMÃ‰LIORÃ‰ -->
    <div class="scoreboard-container">
        <div class="scoreboard-title">ğŸ“Š Tableau des Scores ğŸ“Š</div>
        <div class="scoreboard">
            <div class="player-score">
                <div class="player-label red">{{.Player1Name}}</div>
                <div class="score-value">{{.ScoreP1}}</div>
            </div>
            <div class="score-separator">-</div>
            <div class="player-score">
                <div class="player-label yellow">{{.Player2Name}}</div>
                <div class="score-value">{{.ScoreP2}}</div>
            </div>
        </div>
    </div>

    <!-- Info joueur actuel ou rÃ©sultat -->
    {{if .GameOver}}
        {{if eq .Winner 0}}
            <div id="player-info" class="player-info winner">ğŸ¤ Match nul !</div>
        {{else if eq .Winner 1}}
            <div id="player-info" class="player-info winner">ğŸ† {{.Player1Name}} a gagnÃ© ! ğŸ†</div>
        {{else}}
            <div id="player-info" class="player-info winner">ğŸ† {{.Player2Name}} a gagnÃ© ! ğŸ†</div>
        {{end}}
    {{else}}
        <div id="player-info" class="player-info">
            {{if eq .Player 1}}
                Au tour de {{.Player1Name}} ğŸ”´
            {{else}}
                Au tour de {{.Player2Name}} ğŸŸ¡
            {{end}}
        </div>
    {{end}}

    <div class="game-container">
        <!-- Grille de jeu cliquable -->
        <div id="grid" class="grid">
            {{range $rowIdx, $row := .Grid}}
                {{range $colIdx, $cell := $row}}
                    <div class="cell {{if $.IsWinningCell $rowIdx $colIdx}}winning-cell{{end}} 
                         {{if ne $cell 0}}has-token{{end}}" 
                         data-row="{{$rowIdx}}" 
                         data-col="{{$colIdx}}"
                         {{if and (not $.GameOver) (eq $cell 0)}}onclick="playColumn({{$colIdx}})"{{end}}>
                        {{if eq $cell 1}}
                            <div class="token red" data-col="{{$colIdx}}"></div>
                        {{else if eq $cell 2}}
                            <div class="token yellow" data-col="{{$colIdx}}"></div>
                        {{end}}
                    </div>
                {{end}}
            {{end}}
        </div>
    </div>

    <!-- Formulaire cachÃ© pour jouer -->
    <form id="playForm" action="/play" method="POST" style="display:none;">
        <input type="hidden" name="column" id="columnInput">
    </form>

    <!-- Boutons de contrÃ´le -->
    <div class="button-container">
        <form action="/reset" method="POST" style="display:inline;">
            <button type="submit" class="reset-btn">ğŸ”„ Nouvelle Partie</button>
        </form>
        <form action="/reset-scores" method="POST" style="display:inline;" 
              onsubmit="return confirm('ÃŠtes-vous sÃ»r de vouloir rÃ©initialiser tous les scores ?');">
            <button type="submit" class="score-reset-btn">ğŸ“Š RÃ©initialiser Scores</button>
        </form>
        <form action="/" method="GET" style="display:inline;">
            <button type="submit" class="menu-btn">ğŸ  Menu Principal</button>
        </form>
    </div>

    <script>
        let isAnimating = false;
        let lastPlayedColumn = -1;

        // Fonction pour jouer dans une colonne
        function playColumn(col) {
            if (isAnimating) return;
            
            // VÃ©rifier si la colonne est pleine
            const topCell = document.querySelector(`[data-row="0"][data-col="${col}"]`);
            if (topCell && topCell.classList.contains('has-token')) {
                return;
            }
            
            isAnimating = true;
            lastPlayedColumn = col;
            
            document.getElementById('columnInput').value = col;
            document.getElementById('playForm').submit();
        }

        // Animation des jetons au chargement
        document.addEventListener('DOMContentLoaded', function() {
            const tokens = document.querySelectorAll('.token');
            
            // Si on vient de jouer, animer seulement le dernier jeton
            if (tokens.length > 0) {
                const lastToken = tokens[tokens.length - 1];
                lastToken.classList.add('dropping');
                
                // DÃ©bloquer aprÃ¨s l'animation
                setTimeout(() => {
                    isAnimating = false;
                }, 600);
            }

            // Animation du scoreboard
            const scoreboard = document.querySelector('.scoreboard-container');
            if (scoreboard) {
                scoreboard.style.opacity = '0';
                scoreboard.style.transform = 'translateY(-20px)';
                setTimeout(() => {
                    scoreboard.style.transition = 'all 0.5s ease';
                    scoreboard.style.opacity = '1';
                    scoreboard.style.transform = 'translateY(0)';
                }, 100);
            }

            // Animation du message de victoire
            const winner = document.querySelector('.player-info.winner');
            if (winner) {
                winner.style.transform = 'scale(0.8)';
                winner.style.opacity = '0';
                setTimeout(() => {
                    winner.style.transition = 'all 0.5s ease';
                    winner.style.transform = 'scale(1)';
                    winner.style.opacity = '1';
                }, 300);
            }
        });

        // Effet hover sur les colonnes
        const cells = document.querySelectorAll('.cell');
        let currentHoverCol = -1;

        cells.forEach(cell => {
            const col = parseInt(cell.dataset.col);
            
            cell.addEventListener('mouseenter', () => {
                if (cell.classList.contains('has-token')) return;
                
                currentHoverCol = col;
                const colCells = document.querySelectorAll(`[data-col="${col}"]`);
                colCells.forEach(c => {
                    if (!c.classList.contains('has-token')) {
                        c.classList.add('column-hover');
                    }
                });
            });

            cell.addEventListener('mouseleave', () => {
                const colCells = document.querySelectorAll(`[data-col="${col}"]`);
                colCells.forEach(c => {
                    c.classList.remove('column-hover');
                });
                currentHoverCol = -1;
            });
        });

        // Curseur pointer sur les cellules jouables
        const gameOver = "{{if .GameOver}}true{{else}}false{{end}}" === "true";
        if (!gameOver) {
            document.querySelectorAll('.cell:not(.has-token)').forEach(cell => {
                cell.style.cursor = 'pointer';
            });
        }
    </script>
</body>
</html>