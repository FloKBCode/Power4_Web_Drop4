<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Power 4 - Accueil</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

    <!-- Tutoriel (modale cachée) -->
    <div id="tutorialModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-btn" onclick="closeTutorial()">&times;</span>
            <h2>📚 Comment jouer ?</h2>

            <div class="tutorial-step">
                <h3>🎯 Objectif</h3>
                <p>Alignez <strong>4 jetons</strong> de votre couleur horizontalement, verticalement ou en diagonale.</p>
            </div>

            <div class="tutorial-step">
                <h3>🎮 Contrôles</h3>
                <p><strong>Cliquez sur une case</strong> pour déposer votre jeton dans cette colonne.</p>
            </div>

            <div class="tutorial-step">
                <h3>⚡ Règles</h3>
                <ul>
                    <li>Tour par tour</li>
                    <li>Colonne pleine = impossible de jouer</li>
                    <li>Plateau plein = match nul</li>
                </ul>
            </div>

            <div class="tutorial-step">
                <h3>💡 Astuces</h3>
                <ul>
                    <li>Contrôlez le <strong>centre</strong></li>
                    <li>Créez des <strong>menaces doubles</strong></li>
                    <li>Bloquez votre adversaire</li>
                </ul>
            </div>

            <button onclick="closeTutorial()" class="tutorial-btn-small">✅ J'ai compris !</button>
        </div>
    </div>

    <!-- Conteneur principal -->
    <div class="container">
        <h1>🎮 Power 4 Web 🎮</h1>
        <p class="subtitle">Le célèbre jeu revisité sur le web</p>

        <!-- Bloc reprise de partie -->
        {{if .HasSave}}
        <div class="continue-box">
            <h2>🎮 Partie en cours détectée !</h2>
            <p>Vous avez une partie sauvegardée.</p>
            <div class="button-group">
                <a href="/continue" class="continue-btn">▶️ Continuer</a>
                <button onclick="confirmNewGame()" class="new-game-btn">🆕 Nouvelle partie</button>
            </div>
        </div>
        {{end}}

        <!-- Formulaire de nouvelle partie -->
        <form id="newGameForm" action="/start" method="POST" {{if .HasSave}}style="display:none;"{{end}}>
            
            <!-- Mode de jeu -->
            <div class="mode-selector">
                <h3>Mode de jeu</h3>
                <div class="mode-buttons">
                    <label class="mode-option active" onclick="selectMode('pvp')">
                        <input type="radio" name="game_mode" value="pvp" checked>
                        <div class="mode-card">
                            <div class="mode-icon">👥</div>
                            <div class="mode-title">2 Joueurs</div>
                            <div class="mode-desc">Affrontez un ami</div>
                        </div>
                    </label>

                    <label class="mode-option" onclick="selectMode('ai')">
                        <input type="radio" name="game_mode" value="ai">
                        <div class="mode-card">
                            <div class="mode-icon">🤖</div>
                            <div class="mode-title">Contre IA</div>
                            <div class="mode-desc">Défiez l'ordinateur</div>
                        </div>
                    </label>
                </div>
            </div>

            <!-- Difficulté IA -->
            <div id="difficultySelect" class="difficulty-selector" style="display:none;">
                <h3>Difficulté de l'IA</h3>
                <select name="difficulty" class="difficulty-dropdown">
                    <option value="facile">😊 Facile</option>
                    <option value="moyen" selected>🤔 Moyen</option>
                    <option value="difficile">😈 Difficile</option>
                </select>
            </div>

            <input type="hidden" name="ai_mode" id="aiModeInput" value="">

            <!-- Pseudos -->
            <div class="form-group">
                <label for="player1">
                    <span class="player-icon red-icon">🔴</span>Joueur 1 (Rouge)
                </label>
                <input type="text" id="player1" name="player1" placeholder="Votre pseudo" maxlength="15">
            </div>

            <div class="form-group">
                <label for="player2">
                    <span class="player-icon yellow-icon">🟡</span>
                    <span id="player2Label">Joueur 2 (Jaune)</span>
                </label>
                <input type="text" id="player2" name="player2" placeholder="Pseudo adversaire" maxlength="15">
            </div>

            <!-- Boutons -->
            <button type="submit" class="start-btn">🚀 Lancer la partie</button>
            <button type="button" class="tutorial-btn-small" onclick="showTutorial()">📚 Voir le tutoriel</button>
        </form>

        <!-- Informations -->
        <div class="default-notice">
            💡 Vous pouvez laisser les pseudos vides pour utiliser les noms par défaut
        </div>
        <p class="info-text">Les pseudos sont limités à 15 caractères</p>
    </div>

    <script>
        // Tutoriel au premier lancement
        window.onload = function() {
            const hasSeenTutorial = sessionStorage.getItem('hasSeenTutorial');
            const hasSave = "{{.HasSave}}" === "true";
            if (!hasSeenTutorial && !hasSave) {
                showTutorial();
                sessionStorage.setItem('hasSeenTutorial', 'true');
            }
        };

        function showTutorial() {
            document.getElementById('tutorialModal').style.display = 'flex';
        }

        function closeTutorial() {
            document.getElementById('tutorialModal').style.display = 'none';
        }

        function selectMode(mode) {
            document.querySelectorAll('.mode-option').forEach(opt => opt.classList.remove('active'));
            event.currentTarget.classList.add('active');

            const diff = document.getElementById('difficultySelect');
            const player2 = document.getElementById('player2');
            const label = document.getElementById('player2Label');
            const aiInput = document.getElementById('aiModeInput');
            
            if (mode === 'ai') {
                diff.style.display = 'block';
                label.textContent = 'Ordinateur (Jaune)';
                player2.value = 'Ordinateur';
                aiInput.value = 'on';
            } else {
                diff.style.display = 'none';
                label.textContent = 'Joueur 2 (Jaune)';
                player2.value = '';
                aiInput.value = '';
            }
        }

        function confirmNewGame() {
            if (confirm('Voulez-vous vraiment abandonner la partie en cours ?')) {
                document.getElementById('newGameForm').style.display = 'block';
                document.querySelector('.continue-box').style.display = 'none';
            }
        }

        window.onclick = function(event) {
            const modal = document.getElementById('tutorialModal');
            if (event.target === modal) closeTutorial();
        }
    </script>
</body>
</html>
